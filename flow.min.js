/*!
 * Flow v1.0.0 - A small JavaScript callbacks synchronizer
 * Copyright (c) Stas Granin - https://github.com/StasGranin/flow
 * License: MIT
 */

(function(){function a(){}var b=function(b,c){var d=this;d.a=0,d.b=0,d.c=0,d.d=null,d.e=!1,d.f=!1,d.g=!1,d.h=b||[],d.i=c=c||{},c.defaultSync=c.defaultSync||!1,c.onProgress=c.onProgress||a,c.onFail=c.onFail||a,c.onComplete=c.onComplete||a};if(b.prototype={j:function(a){var b,c=this;c.f&&a===c.b&&(b=c.h[++c.a],c.a===c.h.length-1&&(c.g=!0),b&&((c.i.defaultSync&&b.sync!==!1||b.sync===!0)&&c.c>0?(c.d=b,c.e=!0):c.k(b,void 0,a)))},k:function(a,c,d){var e,f=this,g=void 0!==c;!g&&f.c++,void 0===c&&(c=a.failRetries),a.flow&&a.flow instanceof b?e=function(b,c){return a.flow.restart(b,c)}:a.fn&&"function"==typeof a.fn&&(e=a.fn),e(function(){f.l(Array.prototype.slice.call(arguments,0),a,c,d)},function(){f.m(Array.prototype.slice.call(arguments,0),a,c,d)}),!g&&f.j(d)},l:function(b,c,d,e){var f,g=this,h=c.success||a;g.f&&e===g.b&&(f=h.apply(null,b),f instanceof Error?(b.unshift(f),g.m(b,c,d,e)):(g.i.onProgress(f),g.n(e)))},m:function(a,b,c,d){var e,f=this,g=b.fail||f.o,h=b.retryInterval;f.f&&d===f.b&&(e=g.apply(null,a),c?h?("function"==typeof h&&(h=h(c)),setTimeout(function(){f.k(b,--c,d)},parseInt(h)||0)):f.k(b,--c,d):b.continueOnFail?f.n(d):(f.f=!1,f.i.onFail(e),f.executeFail&&f.executeFail(e)))},n:function(a){var b=this;setTimeout(function(){b.f&&a===b.b&&(b.c--,0===b.c&&(b.e&&(b.e=!1,b.k(b.d,void 0,a)),b.g&&b.p()))},0)},p:function(){var a=this;a.f=!1,a.i.onComplete(),a.executeComplete&&a.executeComplete()},o:function(a){return a},execute:function(a,b){var c=this;return c.f||(c.b++,c.a--,c.g=!1,c.f=!0,c.executeComplete=a,c.executeFail=b,c.j(c.b)),c},restart:function(a,b){var c=this;return c.a=0,c.f=!1,c.c=0,c.d=null,c.e=!1,c.g=!1,c.execute(a,b),c},stop:function(){var a=this;return a.f=!1,a.b++,a},push:function(a){var b=this;return a instanceof Array?Array.prototype.push.apply(b.h,a):b.h.push(a),b},pushAndExecute:function(a,b,c){var d=this;return d.push(a),d.execute(b,c),d}},"undefined"!=typeof exports)"undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Flow=b;else{if(this.Flow)throw new Error("Flow variable is already assigned");this.Flow=b}}).call(this);